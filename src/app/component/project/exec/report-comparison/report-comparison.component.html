<mat-card class="toolbar-view-comp">
  <div layout="row">
    <div class="toolbar-text-container">
      <p class="text-18 text-center height-auto toolbar-text">View</p>
    </div>&nbsp;&nbsp;
    <button mat-raised-button class="iconBtn-lg" color="{{viewButtonsClasses[0]}}" (click)="updateViewMode(0, 0)">
      <b>Complete log</b>
    </button>&nbsp;&nbsp;
    <button mat-raised-button class="iconBtn-lg" color="{{viewButtonsClasses[3]}}" (click)="updateViewMode(0, 3)">
      <b>Only tests log</b>
    </button>&nbsp;&nbsp;
    <button mat-raised-button class="iconBtn-lg" color="{{viewButtonsClasses[1]}}" (click)="updateViewMode(0, 1)">
      <b>All tests</b>
    </button>&nbsp;&nbsp;
    <button mat-raised-button class="iconBtn-lg" color="{{viewButtonsClasses[2]}}" (click)="updateViewMode(0, 2)">
      <b>Failed tests</b>
    </button>&nbsp;&nbsp;&nbsp;
    <mat-divider class="divider-vertical"></mat-divider>&nbsp;&nbsp;&nbsp;
    <div class="toolbar-text-container">
      <p class="text-18 text-center height-auto toolbar-text">Comparison</p>
    </div>&nbsp;&nbsp;
    <button mat-raised-button class="iconBtn-lg" color="{{comparisonButtonsClasses[0]}}"
            (click)="updateComparisonMode(0)">
      <b>Complete</b>
    </button>&nbsp;&nbsp;
    <button mat-raised-button class="iconBtn-lg" color="{{comparisonButtonsClasses[1]}}"
            (click)="updateComparisonMode(1)">
      <b>No timestamp</b>
    </button>&nbsp;&nbsp;
    <button mat-raised-button class="iconBtn-lg" color="{{comparisonButtonsClasses[2]}}"
            (click)="updateComparisonMode(2)">
      <b>Time diff</b>
    </button>&nbsp;&nbsp;
    <button mat-icon-button color="accent" (click)="showExecSelection = !showExecSelection">
      <mat-icon *ngIf="showExecSelection == false">keyboard_arrow_down</mat-icon>
      <mat-icon *ngIf="showExecSelection == true">keyboard_arrow_up</mat-icon>
    </button>
    <button *ngIf="comparisonInProgress" mat-icon-button color="accent" (click)="disableComparison()">
      <mat-icon>wrap_text</mat-icon>
    </button>
    <span flex></span>
    <button *ngIf="test != undefined" mat-raised-button class="iconBtn-lg" color="accent"
            [routerLink]="['/projects/', project]">
      <mat-icon>arrow_back</mat-icon>
    </button>
  </div>
  <div *ngIf="showExecSelection" class="table-selection">
    <br>
    <mat-divider></mat-divider>
    <div *ngIf="showSelectionMessage">
      <td-message label="Error!" sublabel="You must select an execution to compare with." color="warn" icon="error"></td-message>
    </div>
    <td-data-table [clickable]="true"
                   [columns]="execsData"
                   [data]="execsRow"
                   [multiple]="false"
                   [selectable]="true"
                   [sortable]="false"
                   (rowSelect)="selectEvent($event)"
                   [(ngModel)]="selected">
      <ng-template *ngFor="let column of execsData" tdDataTableTemplate="{{column.name}}" let-value="value"
                   let-row="row">
        <div *ngIf="column.name !== 'options'" (click)="viewExec(row)">{{value}}</div>
      </ng-template>
      <ng-template tdDataTableTemplate="status" let-value="value">
        <mat-icon [ngClass]="value.class">{{value.icon}}</mat-icon>&nbsp;&nbsp;{{value.status}}
      </ng-template>
      <ng-template tdDataTableTemplate="options" let-value="value" let-row="row" let-column="column">
        <div *ngIf="(deleteInProgress && (row.id === execDeleting)); else notDeleting">
          <div class="iconBtn-lg">
            <mat-spinner [diameter]="25"></mat-spinner>
          </div>
        </div>
        <ng-template #notDeleting>
          <div layout="row">
            <button class="iconBtn-lg"
                    mat-button
                    stopRowClick
                    title="Delete execution"
                    (click)="delete(row)"
                    [disabled]="(row.id !== execDeleting) && deleteInProgress">
              <mat-icon [ngClass]="{'tc-grey-300': (row.id !== execDeleting) && deleteInProgress}">delete</mat-icon>
            </button>
            <button class="iconBtn-lg"
                    mat-button
                    stopRowClick
                    title="View execution"
                    (click)="goTo(row)">
              <mat-icon>remove_red_eye</mat-icon>
            </button>
          </div>
        </ng-template>
      </ng-template>
    </td-data-table>
  </div>
</mat-card>
<mat-card style="margin-top: 88px; margin-bottom: 50px">
  <mat-card-content>
    <div *ngIf="comparisonInProgress; else notComparing">
      <table *ngIf="viewMode == 0 || viewMode == 3" class="diff-table">
        <tbody>
        <tr *ngFor="let result of resultData[0].logs">
          <td [innerHTML]="result.index_p" class="index" style="width: 1%"></td>
          <td [innerHTML]="result.com_p.content" [class]="result.com_p.class" style="width: 49%"></td>
          <td [innerHTML]="result.indexp" class="index" style="width: 1%"></td>
          <td [innerHTML]="result.comp.content" [class]="result.comp.class" style="width: 49%"></td>
        </tr>
        </tbody>
      </table>
      <div *ngIf="viewMode == 1 || viewMode == 2">
        <ng-template ngFor let-class [ngForOf]="resultData">
          <h3>{{class.name}}</h3>
          <ng-template ngFor let-method [ngForOf]="class.methods">
            <h5>{{method.name}}</h5>
            <table class="diff-table">
              <tbody>
              <tr *ngFor="let result of method.logs">
                <td [innerHTML]="result.index_p" class="index" style="width: 1%"></td>
                <td [innerHTML]="result.com_p.content" [class]="result.com_p.class" style="width: 49%"></td>
                <td [innerHTML]="result.indexp" class="index" style="width: 1%"></td>
                <td [innerHTML]="result.comp.content" [class]="result.comp.class" style="width: 49%"></td>
              </tr>
              </tbody>
            </table>
          </ng-template>
        </ng-template>
      </div>
    </div>
    <ng-template #notComparing>
      <div *ngIf="viewMode == 0 || viewMode == 3">
        <table class="diff-table">
          <tbody>
            <tr *ngFor="let log of classesL; index as i">
              <td class="index">{{i}}.</td>
              <td>{{log.log}}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="viewMode == 1 || viewMode == 2">
        <ng-template ngFor let-item [ngForOf]="classesL">
          <h3>{{item.name}}</h3>
          <ng-template ngFor let-itemm [ngForOf]="item.methods">
            <h5>{{itemm.name}}</h5>
            <table class="diff-table">
              <tbody>
              <tr *ngFor="let log of itemm.logs; index as i">
                <td class="index">{{i}}.</td>
                <td>{{log.timestamp}} [{{log.thread}}] {{log.level}} {{log.logger}} - {{log.message}}</td>
              </tr>
              </tbody>
            </table>
            <br>
          </ng-template>
        </ng-template>
        <div *ngIf="classesL.length == 0">
          <td-message label="Info" sublabel="The execution has not unsuccessful methods." color="blue" icon="info"></td-message>
        </div>
      </div>
    </ng-template>
  </mat-card-content>
</mat-card>
<div class="status-feedback">
  <div *ngIf="comparisonInProgress; else showBasicMessage">
    <div class="half-part" style="float: left">
      <td-message *ngIf="status.includes('FAILURE')" label="Build failure" sublabel="This execution contains some errors so the build had failed." color="warn" icon="error"><br></td-message>
      <td-message *ngIf="!status.includes('FAILURE')" label="Build success" sublabel="This execution has finished successfully." color="green" icon="check_circle"></td-message>
    </div>
    <div class="half-part" style="float: right; border-left: 2px white">
      <td-message *ngIf="selected[0].status.status.includes('FAILURE')" label="Build failure" sublabel="This execution contains some errors so the build had failed." color="warn" icon="error"><br></td-message>
      <td-message *ngIf="!selected[0].status.status.includes('FAILURE')" label="Build success" sublabel="This execution has finished successfully." color="green" icon="check_circle"></td-message>
    </div>
  </div>
  <ng-template #showBasicMessage>
    <td-message *ngIf="status.includes('FAILURE')" label="Build failure" sublabel="This execution contains some errors so the build had failed." color="warn" icon="error"><br></td-message>
    <td-message *ngIf="!status.includes('FAILURE')" label="Build success" sublabel="This execution has finished successfully." color="green" icon="check_circle"></td-message>
  </ng-template>
</div>
